$(document).ready(function(){var e=window.location.hostname;"localhost"===e&&(e="127.0.0.1:"+window.location.port);var t=io.connect(e),o="Not Choosen";function n(e){let t=document.getElementById(e);t.parentNode.removeChild(t)}$("#globalLoading").hide(),$("#namePrompt").hide(),$("#joinGame").hide(),$("#choosePlacement").hide(),$("#board").hide(),$("#gameOver").hide(),window.localStorage.getItem("username")?(o=window.localStorage.getItem("username"),t.emit("updateSocket",{username:o,token:window.localStorage.getItem("userjwt")}),$("#globalLoading").show(),$("#namePrompt").hide()):($("#namePrompt").show(),$("#errorName").text("."));var r=!1;$("#btnSubmitName").on("click",function(){if($("#errorName").text("."),r)$("#errorName").text("Please Wait");else{let e=function(e){if(e.length<5)return"Too Short. Minimum 5 characters";if(e.length>25)return"Too Long. Maximum 25 characters";return/^\w+$/.test(e)?"OK":"Please Choose alphabets, numbers or '_'"}($("#inptName").val());"OK"===e?(r=!0,t.emit("addUser",{name:$("#inptName").val()}),$("#globalLoading").show()):$("#errorName").text(e)}}),t.on("userAdded",function(e){$("#globalLoading").hide(),"OK"===e.msg?(n("namePrompt"),$("#joinGame").show(),window.localStorage.setItem("username",e.name),window.localStorage.setItem("userjwt",e.token)):(r=!1,$("#errorName").text(e.msg))}),t.on("socketUpdated",function(e){$("#globalLoading").hide(),n("namePrompt"),$("#joinGame").show()}),t.on("socketUpdateRejected",function(e){$("#globalLoading").hide(),window.localStorage.removeItem("username"),window.localStorage.removeItem("userjwt"),$("#namePrompt").show()});var l=!1;$("#btnJoin").click(function(){$("#errorJoin").text("."),l?$("#errorJoin").text("Wait"):(l=!0,t.emit("join",{player:o}),$("#globalLoading").show())}),t.on("lockJoin",function(e){$("#errorJoin").text("Wait"),l=!0}),t.on("startGame",function(e){l=!1,n("joinGame"),$("#globalLoading").hide(),$("#choosePlacement").show(),console.log("Player2 is"+e.otherPlayer)});var a=!1;$("#btnReady").click(function(){if($("#errorReady").text("."),a)$("#errorReady").text("Wait");else if(function(){for(let e in u){if(u[e].size!==i[e])return!1;if(!h[e])return!1}return!0}()){a=!0;for(let e in m)m[e]=!0;let e=function(){let e={};for(let t in u){e[t]={};let o=u[t],n=o.keys(),r=0;for(;!n.done;){let o=n.next();if(!(o=o.value))break;o=JSON.parse(o),e[t][r]=o,r++}}return e}();t.emit("boardMade",{player:o,shipPlacement:e})}else $("#errorReady").text("Invlid Board")});var i={A:5,B:4,C:3,D:3,E:2},d=["1","2","3","4","5","6","7","8","9","10"],s=["A","B","C","D","E","F","G","H","I","J"];var c=new Array(null,null,null,null,null,null,null,null,null,null);for(let e=0;e<10;e++)c[e]=new Array(0,0,0,0,0,0,0,0,0,0);var u={A:new Set,B:new Set,C:new Set,D:new Set,E:new Set},f={A:!1,B:!1,C:!1,D:!1,E:!1},h={A:!1,B:!1,C:!1,D:!1,E:!1},m={A:!1,B:!1,C:!1,D:!1,E:!1};function p(e){let t=$("#"+e+"i").val(),o=$("#"+e+"j").val();o=o.toUpperCase(),g(e,!1),$("#errorPlaceShip"+e).text(".");let n=!0,r=!0;t&&o&&(d.indexOf(t)>-1&&s.indexOf(o)>-1?(n=function(e,t,o,n){if(n){if(s.indexOf(t)+i[o]>10)return!1}else if(d.indexOf(e)+i[o]>10)return!1;return!0}(t,o,e,f[e]))?(r=function(e,t,o,n){let r=s.indexOf(t),l=d.indexOf(e),a=new Set;if(n)for(let e=r;e<r+i[o];e++)a.add(JSON.stringify({x:l,y:e}));else for(let e=l;e<l+i[o];e++)a.add(JSON.stringify({x:e,y:r}));for(let e in u)if(e!=o){let t=new Set([...u[e]].filter(e=>a.has(e)));if(t.size>0)return!1}return!0}(t,o,e,f[e]))?(h[e]&&function(e){let t=u[e],o=t.keys();for(;!o.done&&(t=(t=o.next()).value);)t=JSON.parse(t),$("#cell-"+t.x+t.y).removeClass("ship"+e);u[e]=new Set}(e),h[e]=!0,function(e,t,o,n){let r=u[e];if(r.clear(),n)for(let n=o;n<o+i[e];n++)r.add(JSON.stringify({x:t,y:n}));else for(let n=t;n<t+i[e];n++)r.add(JSON.stringify({x:n,y:o}))}(e,d.indexOf(t),s.indexOf(o),f[e]),function(e,t,o,n){if(n)for(let n=o;n<o+i[e];n++)$("#cell-"+t+n).addClass("ship"+e);else for(let n=t;n<t+i[e];n++)$("#cell-"+n+o).addClass("ship"+e)}(e,d.indexOf(t),s.indexOf(o),f[e])):(g(e,!0),$("#errorPlaceShip"+e).text("Overlapping Ships")):(g(e,!0),$("#errorPlaceShip"+e).text("Out of bounds")):(g(e,!0),$("#errorPlaceShip"+e).text("Inavlid Entries")))}function g(e,t){t?($("#errorPlaceShip"+e).addClass("label-danger"),$("#errorPlaceShip"+e).removeClass("label-default")):($("#errorPlaceShip"+e).removeClass("label-danger"),$("#errorPlaceShip"+e).addClass("label-default"))}$(".inptXY").change(function(){let e=$(this).data("ship");if(m[e])return g(e,!0),void $("#errorPlaceShip"+e).text("Locked");p(e)}),$(".btnRot").click(function(){let e=$(this).data("ship");if(m[e])return g(e,!0),void $("#errorPlaceShip"+e).text("Locked");f[e]=!f[e],f[e]?$("#btnRotIndic"+e).text("Currently Horizontal"):$("#btnRotIndic"+e).text("Currently Vertical"),p(e)}),$(".btnDrop").click(function(){let e=$(this).data("ship");if(m[e])return g(e,!0),void $("#errorPlaceShip"+e).text("Already Locked");h[e]?(this.classList.remove("btn-primary"),this.classList.add("btn-danger"),m[e]=!0):(g(e,!0),$("#errorPlaceShip"+e).text("Please Place before locking"))}),t.on("wait",function(e){"Error"===e.status?$("#errorReady").text(e.msg):($("#globalLoading").show(),function(){let e=document.getElementById("chooseBoard"),t=e.cloneNode(!0),o=e.cloneNode(!0),n=document.getElementById("battleBoard");(function e(t){t.id&&(t.id="opp-"+t.id);t.className=t.className.replace(/ ship[A-E]/,"");if(t.childElementCount>0)for(let o=0;o<t.childElementCount;o++)e(t.children[o])})(o),n.appendChild(t),n.appendChild(o)}(),n("choosePlacement"),$("#board").show())});var x={},w={A:new Set,B:new Set,C:new Set,D:new Set,E:new Set},S=[null,null,null,null,null,null,null,null,null,null];for(let e=0;e<10;e++)S[e]=new Array(0,0,0,0,0,0,0,0,0,0);var y=!1,v={};function b(e){e?($("#errorShoot").addClass("label-danger"),$("#errorShoot").removeClass("label-default")):($("#errorShoot").removeClass("label-danger"),$("#errorShoot").addClass("label-default"))}t.on("disconnect",function(e){$("#globalLoading").show()}),t.on("go",function(e){e.start&&($("#globalLoading").hide(),y=!0);for(let e in u)x[e]=new Set(u[e])}),$("#btnShoot").click(function(){if(y){let e=$("#shoti").val(),n=$("#shotj").val();n=n.toUpperCase(),b(!1),d.indexOf(e)>-1&&s.indexOf(n)>-1?(n=s.indexOf(n),e=d.indexOf(e),0===S[e][n]?($("#globalLoading").show(),t.emit("makeMove",{player:o,move:{x:e,y:n}}),v.x=e,v.y=n):(b(!0),$("#errorShoot").text("Already"))):(b(!0),$("#errorShoot").text("Invlid Entry"))}else b(!0),$("#errorShoot").text("Please Wait For Your turn")}),t.on("yourMove",function(e){"Hit"===e.result?(y=!y,S[v.x][v.y]=1,$("#opp-cell-"+v.x+v.y).addClass("hit"),w[e.extra.partOf].add(JSON.stringify(v)),e.extra.shipDown&&(!function(e){let t=w[e],o=t.keys();for(;!o.done&&(t=(t=o.next()).value);)t=JSON.parse(t),$("#opp-cell-"+t.x+t.y).addClass("ship"+e)}(e.extra.partOf),e.extra.gameOver&&(n("board"),$("#gameOver").show(),$("#gameOverLose").hide()))):"Miss"===e.result?(y=!y,S[v.x][v.y]=-1,$("#opp-cell-"+v.x+v.y).addClass("miss")):$("#errorShoot").text("Repeat")}),t.on("oppMove",function(e){"Hit"===e.result?(y=!y,$("#cell-"+e.point.x+e.point.y).addClass("hit"),e.extra.gameOver&&(n("board"),$("#globalLoading").hide(),$("#gameOver").show(),$("#gameOverWin").hide())):"Miss"===e.result&&(y=!y,$("#cell-"+e.point.x+e.point.y).addClass("miss")),$("#globalLoading").hide()});var C=document.getElementById("_dot1"),O=document.getElementById("_dot2"),P=["f44336","#E91E63","#9C27B0","#673AB7","#3F51B5","#2196F3","#03A9F4","#00BCD4","#009688","#4CAF50","#8BC34A","#CDDC39","#FFEB3B","#FFC107","#FF9800","#FF5722"],k=P.length;setInterval(function(){let e=parseInt(Math.random()*k);C.style.backgroundColor=P[e],e=parseInt(Math.random()*k),O.style.backgroundColor=P[e]},1500)});